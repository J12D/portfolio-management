\documentclass[roman]{scrreprt}

\usepackage{jdcommands}
\jdfontsetup{}

\usepackage[USenglish]{babel}

\usepackage{pgfplots}
\pgfplotsset{compat=1.12}
\usepgfplotslibrary{dateplot}

\usepackage{subcaption}

%xtick={2008-01-01,2009-01-01,2010-01-01,2001-01-01,2012-01-01, 2013-01-01, 2014-01-01, 2015-01-01},
\pgfplotsset{y label style={at={(axis description cs:-0.08,.5)}, text depth=0.25ex, anchor=south,}}

\newenvironment{performanceplot}[1][]{
\begin{tikzpicture}
\begin{axis}[
		no marks,
		date coordinates in=x,
		xticklabel=\year,
    xtick={2008-01-01,2009-01-01,2010-01-01,2011-01-01,2012-01-01, 2013-01-01, 2014-01-01, 2015-01-01},
		%xticklabel style={/pgf/number format/.cd,fixed,precision=2},
    %yticklabel=\pgfmathparse{100*\tick}\pgfmathprintnumber{\pgfmathresult}\,\%,
    yticklabel style={/pgf/number format/fixed,/pgf/number format/precision=2},
		ylabel=Performance,
		xlabel=Time,
    legend pos = north west,
    every axis plot/.append style={thick, smooth},
    width=\textwidth,
    height=0.5\textwidth,
    #1]
}{%
\end{axis}
\end{tikzpicture}
}

\newcommand{\portfolioperformanceplot}[2]{
\begin{tikzpicture}
\begin{axis}[
		no marks,
		date coordinates in=x,
		xticklabel=\year,
    xtick={2008-01-01,2009-01-01,2010-01-01,2011-01-01,2012-01-01, 2013-01-01, 2014-01-01, 2015-01-01},
		%xticklabel style={/pgf/number format/.cd,fixed,precision=2},
    %yticklabel=\pgfmathparse{100*\tick}\pgfmathprintnumber{\pgfmathresult}\,\%,
    yticklabel style={/pgf/number format/fixed,/pgf/number format/precision=2},
		ylabel=Performance,
		xlabel=Time,
    legend pos = north west,
    every axis plot/.append style={thick, smooth},
    width=\textwidth,
    height=0.5\textwidth,
    #2]
  \addplot table[x=time, y=value] {plot-data/#1.txt};
\end{axis}
\end{tikzpicture}
}

\newcommand{\decomposeplot}[2]{
\begin{tikzpicture}
\begin{axis}[
		no marks,
		date coordinates in=x,
		xticklabel=\year,
    xtick={2008-01-01,2009-01-01,2010-01-01,2011-01-01,2012-01-01, 2013-01-01, 2014-01-01, 2015-01-01},
    yticklabel style={/pgf/number format/fixed,/pgf/number format/precision=2},
    ylabel=Asset value,
    ymin=0,
		xlabel=Time,
    legend pos = north west,
    every axis plot/.append style={thick, smooth},
    width=\textwidth,
    height=0.5\textwidth,
    legend pos = north west,
    stack plots=y,area style,
    trim axis left,trim axis right,
    #2]
  \addplot table[x=time, y=value.DAX] {plot-data/#1.txt}\closedcycle;
  \addlegendentry{DAX}
  \addplot table[x=time, y=value.Dow.Jones] {plot-data/#1.txt}\closedcycle;
  \addlegendentry{Dow Jones}
  \addplot table[x=time, y=value.Nikkei] {plot-data/#1.txt}\closedcycle;
  \addlegendentry{Nikkei}
\end{axis}
\end{tikzpicture}
}

\newcommand{\decomposerelplot}[2]{
\begin{tikzpicture}
\begin{axis}[
		no marks,
		date coordinates in=x,
		xticklabel=\year,
    xtick={2008-01-01,2009-01-01,2010-01-01,2011-01-01,2012-01-01, 2013-01-01, 2014-01-01, 2015-01-01},
    yticklabel style={/pgf/number format/fixed,/pgf/number format/precision=2},
    ylabel=Asset value,
    ymin=0,
		xlabel=Time,
    legend pos = north west,
    every axis plot/.append style={thick, smooth},
    width=\textwidth,
    height=0.5\textwidth,
    legend pos = north west,
    stack plots=y,area style,
    yticklabel=\pgfmathparse{100*\tick}\pgfmathprintnumber{\pgfmathresult}\,\%,
    ylabel=Weights,
    trim axis left,trim axis right,
    #2]
  \addplot table[x=time, y=value.DAX] {plot-data/#1.txt}\closedcycle;
  \addlegendentry{DAX}
  \addplot table[x=time, y=value.Dow.Jones] {plot-data/#1.txt}\closedcycle;
  \addlegendentry{Dow Jones}
  \addplot table[x=time, y=value.Nikkei] {plot-data/#1.txt}\closedcycle;
  \addlegendentry{Nikkei}
\end{axis}
\end{tikzpicture}
}


\title{Portfolios for a safe future}
\author{JD POWER}
\begin{document}
\maketitle

\chapter*{Investment Objectives}
Presenting you our portfolio choices, we

\begin{itemize}
  \item Drawdown less than 10\% per year
  \item Turnover of less than 10\% per year
  \item Maximize Sharpe-Ratio
\end{itemize}

\chapter*{Asset Universe}
We're looking at 4 assets: DAX

\begin{performanceplot}[ylabel=Asset value]
  \addplot table[x=time, y=value.DAX] {plot-data/assets.txt};
  \addlegendentry{DAX}
  \addplot table[x=time, y=value.Dow.Jones] {plot-data/assets.txt};
  \addlegendentry{Dow Jones}
  \addplot table[x=time, y=value.Nikkei] {plot-data/assets.txt};
  \addlegendentry{Nikkei}
  \addplot table[x=time, y=value.VIX] {plot-data/assets.txt};
  \addlegendentry{!VIX}
\end{performanceplot}


\chapter*{Investment Opportunities}
\section*{Max Sharpe Ratio}
\portfolioperformanceplot{max_sharpe}{}

\section*{Equal-Weighted}

\section*{Portfolio 3}

\chapter*{Performance Evaluation}

\section*{Mean No Short}

\section*{1/N}
\begin{figure}[!h]
\centering
\begin{subfigure}[b]{\textwidth}
\centering
\decomposeplot{equal}{trim axis left,trim axis right}
\end{subfigure}
\begin{subfigure}[b]{\textwidth}
\centering
\decomposerelplot{equal_relw}{trim axis left,trim axis right}
\end{subfigure}
\end{figure}

\section*{Min Variance}
\begin{figure}[!h]
\centering
\begin{subfigure}[b]{\textwidth}
\centering
\decomposeplot{minv}{}
\end{subfigure}
\begin{subfigure}[b]{\textwidth}
\centering
\decomposerelplot{minv_relw}{}
\end{subfigure}
\end{figure}

\section*{Black-Litterman}
\begin{figure}[!h]
\centering
\begin{subfigure}[b]{\textwidth}
\centering
\decomposeplot{black_littie}{}
\end{subfigure}
\begin{subfigure}[b]{\textwidth}
\centering
\decomposerelplot{black_littie_relw}{}
\end{subfigure}
\end{figure}

\section*{Max Sharpe}
\begin{figure}[!h]
\centering
\begin{subfigure}[b]{\textwidth}
\centering
\decomposeplot{ms}{}
\end{subfigure}
\begin{subfigure}[b]{\textwidth}
\centering
\decomposerelplot{ms_relw}{}
\end{subfigure}
\end{figure}

\end{document}
