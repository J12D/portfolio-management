\documentclass[roman]{scrreprt}

\usepackage{jdcommands}
\jdfontsetup{}

\usepackage[USenglish]{babel}

\usepackage{pgfplots}
\pgfplotsset{compat=newest}
\usepgfplotslibrary{dateplot,colorbrewer}

\usepackage{subcaption}

%xtick={2008-01-01,2009-01-01,2010-01-01,2001-01-01,2012-01-01, 2013-01-01, 2014-01-01, 2015-01-01},
\pgfplotsset{y label style={at={(axis description cs:-0.08,.5)}, text depth=0.25ex, anchor=south,}}

\newenvironment{performanceplot}[1][]{
\begin{tikzpicture}
\begin{axis}[
		no marks,
		date coordinates in=x,
		xticklabel=\year,
    xtick={2008-01-01,2009-01-01,2010-01-01,2011-01-01,2012-01-01, 2013-01-01, 2014-01-01, 2015-01-01},
		%xticklabel style={/pgf/number format/.cd,fixed,precision=2},
    %yticklabel=\pgfmathparse{100*\tick}\pgfmathprintnumber{\pgfmathresult}\,\%,
    yticklabel style={/pgf/number format/fixed,/pgf/number format/precision=2},
		ylabel=Performance,
		xlabel=Time,
    legend pos = north west,
    every axis plot/.append style={thick, smooth},
    width=\textwidth,
    height=0.5\textwidth,
    #1]
}{%
\end{axis}
\end{tikzpicture}
}

\newcommand{\portfolioperformanceplot}[2]{
\begin{tikzpicture}
\begin{axis}[
		no marks,
		date coordinates in=x,
		xticklabel=\year,
    xtick={2008-01-01,2009-01-01,2010-01-01,2011-01-01,2012-01-01, 2013-01-01, 2014-01-01, 2015-01-01},
		%xticklabel style={/pgf/number format/.cd,fixed,precision=2},
    %yticklabel=\pgfmathparse{100*\tick}\pgfmathprintnumber{\pgfmathresult}\,\%,
    yticklabel style={/pgf/number format/fixed,/pgf/number format/precision=2},
		ylabel=Performance,
		xlabel=Time,
    legend pos = north west,
    every axis plot/.append style={thick, smooth},
    width=\textwidth,
    height=0.5\textwidth,
    #2]
  \addplot table[x=time, y=value] {plot-data/#1.txt};
\end{axis}
\end{tikzpicture}
}

\newcommand{\decomposeplot}[2]{
\begin{tikzpicture}
\begin{axis}[
		no marks,
		date coordinates in=x,
		xticklabel=\year,
    xtick={2008-01-01,2009-01-01,2010-01-01,2011-01-01,2012-01-01, 2013-01-01, 2014-01-01, 2015-01-01},
    yticklabel style={/pgf/number format/fixed,/pgf/number format/precision=2},
    ylabel=Asset value,
    ymin=0,
		xlabel=Time,
    legend pos = north west,
    every axis plot/.append style={thick, smooth},
    width=\textwidth,
    height=0.5\textwidth,
    legend pos = north west,
    stack plots=y,area style,
    trim axis left,trim axis right,
    #2]
  \addplot table[x=time, y=value.DAX] {plot-data/#1.txt}\closedcycle;
  \addlegendentry{DAX}
  \addplot table[x=time, y=value.Dow.Jones] {plot-data/#1.txt}\closedcycle;
  \addlegendentry{Dow Jones}
  \addplot table[x=time, y=value.Nikkei] {plot-data/#1.txt}\closedcycle;
  \addlegendentry{Nikkei}
\end{axis}
\end{tikzpicture}
}

\newcommand{\decomposerelplot}[2]{
\begin{tikzpicture}
\begin{axis}[
		no marks,
		date coordinates in=x,
		xticklabel=\year,
    xtick={2008-01-01,2009-01-01,2010-01-01,2011-01-01,2012-01-01, 2013-01-01, 2014-01-01, 2015-01-01},
    yticklabel style={/pgf/number format/fixed,/pgf/number format/precision=2},
    ylabel=Asset value,
    ymin=0,
		xlabel=Time,
    legend pos = north west,
    every axis plot/.append style={thick, smooth},
    width=\textwidth,
    height=0.5\textwidth,
    legend pos = north west,
    stack plots=y,area style,
    yticklabel=\pgfmathparse{100*\tick}\pgfmathprintnumber{\pgfmathresult}\,\%,
    ylabel=Weights,
    trim axis left,trim axis right,
    #2]
  \addplot table[x=time, y=value.DAX] {plot-data/#1.txt}\closedcycle;
  \addlegendentry{DAX}
  \addplot table[x=time, y=value.Dow.Jones] {plot-data/#1.txt}\closedcycle;
  \addlegendentry{Dow Jones}
  \addplot table[x=time, y=value.Nikkei] {plot-data/#1.txt}\closedcycle;
  \addlegendentry{Nikkei}
\end{axis}
\end{tikzpicture}
}

\newcommand{\doubleplot}[1]{
\begin{figure}[!h]
\centering
\begin{subfigure}[b]{\textwidth}
\centering
\decomposeplot{#1}{trim axis left,trim axis right}
\end{subfigure}
\begin{subfigure}[b]{\textwidth}
\centering
\decomposerelplot{#1_relw}{trim axis left,trim axis right}
\end{subfigure}
\end{figure}%
}

\newenvironment{growtop}[2]{
\begin{axis}[
  colorbrewer cycle list=Set1,
		no marks,
		date coordinates in=x,
		xticklabel=\year,
    xtick={2008-01-01,2009-01-01,2010-01-01,2011-01-01,2012-01-01, 2013-01-01, 2014-01-01, 2015-01-01},
    yticklabel style={/pgf/number format/fixed,/pgf/number format/precision=2},
    ylabel=Asset value,
		xlabel=Time,
    legend pos = north west,
    every axis plot/.append style={thick, smooth},
    width=\textwidth,
    height=0.5\textwidth,
    legend pos = north west,
    stack plots=y,area style,
    yticklabel=\pgfmathparse{100*\tick}\pgfmathprintnumber{\pgfmathresult}\,\%,
    y filter/.code={\pgfmathparse{max(#1,0)}\pgfmathresult},
    ylabel=Weights,
    ymin=#1,ymax=#2,
    trim axis left,trim axis right]
}{
\end{axis}
}

\newenvironment{growbottom}[2]{
\begin{axis}[
  colorbrewer cycle list=Set1,
    no marks,
    axis y line = none,
    date coordinates in=x,
    xticklabel=\year,
    xtick={2008-01-01,2009-01-01,2010-01-01,2011-01-01,2012-01-01, 2013-01-01, 2014-01-01, 2015-01-01},
    xlabel=Time,
    every axis plot/.append style={thick, smooth},
    width=\textwidth,
    height=0.5\textwidth,
    legend pos = north west,
    stack plots=y,area style,
    stack dir=plus,
    ymin=#1, ymax=#2,
    y filter/.code={\pgfmathparse{min(#1,0)}\pgfmathresult},
    trim axis left,trim axis right]
}{
\end{axis}
}

\title{Portfolios for a safe future}
\author{JD POWER}
\begin{document}
\maketitle

\pgfplotsset{
   relw/.style 2 args={
      colorbrewer cycle list=Set1,
      no marks,
      date coordinates in=x,
      xticklabel=\year,
      xtick={2008-01-01,2009-01-01,2010-01-01,2011-01-01,2012-01-01, 2013-01-01, 2014-01-01, 2015-01-01},
      yticklabel style={/pgf/number format/fixed,/pgf/number format/precision=2},
      ylabel=Weights,
      xlabel=Time,
      legend pos = north west,
      every axis plot/.append style={thick, smooth},
      width=\textwidth,
      height=0.5\textwidth,
      legend pos = north west,
      stack plots=y,area style,
      yticklabel=\pgfmathparse{100*\tick}\pgfmathprintnumber{\pgfmathresult}\,\%,
      ymin=#1, ymax=#2,
      trim axis left,trim axis right
    },
  top/.style={y filter/.code={\pgfmathparse{max(#1,0)}\pgfmathresult}},
  bottom/.style={y filter/.code={\pgfmathparse{min(#1,0)}\pgfmathresult}},
}

\pgfplotsset{
   w/.style 2 args={
      colorbrewer cycle list=Set1,
      no marks,
      date coordinates in=x,
      xticklabel=\year,
      xtick={2008-01-01,2009-01-01,2010-01-01,2011-01-01,2012-01-01, 2013-01-01, 2014-01-01, 2015-01-01},
      yticklabel style={/pgf/number format/fixed,/pgf/number format/precision=2},
      ylabel=Portfolio value,
      xlabel=Time,
      legend pos = north west,
      every axis plot/.append style={thick, smooth},
      width=\textwidth,
      height=0.5\textwidth,
      legend pos = north west,
      stack plots=y,area style,
      yticklabel=\pgfmathparse{\tick}\pgfmathprintnumber{\pgfmathresult}\,\%,
      ymin=#1, ymax=#2,
      trim axis left,trim axis right
    },
  top/.style={y filter/.code={\pgfmathparse{max(#1,0)}\pgfmathresult}},
  bottom/.style={axis y line = none},
}



\chapter*{Investment Objectives}
Presenting you our portfolio choices, we

\begin{itemize}
  \item Drawdown less than 10\% per year
  \item Turnover of less than 10\% per year
  \item Maximize Sharpe-Ratio
\end{itemize}

%\section*{Min Variance}
%\begin{tikzpicture}
  %\begin{axis}[relw={-0.3}{1.3}, y filter/.code={\pgfmathparse{max(#1,0)}\pgfmathresult}]
    %\addplot table[x=time, y=value.DAX] {plot-data/minv_relw.txt}\closedcycle;
    %\addlegendentry{DAX}
    %\addplot table[x=time, y=value.Dow.Jones] {plot-data/minv_relw.txt}\closedcycle;
    %\addlegendentry{Dow Jones}
    %\addplot table[x=time, y=value.Nikkei] {plot-data/minv_relw.txt}\closedcycle;
    %\addlegendentry{Nikkei}
  %\end{axis}
  %\begin{axis}[relw={-0.3}{1.3}, y filter/.code={\pgfmathparse{min(#1,0)}\pgfmathresult}]
    %\addplot table[x=time, y=value.DAX] {plot-data/minv_relw.txt}\closedcycle;
    %\addplot table[x=time, y=value.Dow.Jones] {plot-data/minv_relw.txt}\closedcycle;
    %\addplot table[x=time, y=value.Nikkei] {plot-data/minv_relw.txt}\closedcycle;
  %\end{axis}
%\end{tikzpicture}

%\section*{Max Sharpe}
%\begin{tikzpicture}
  %\begin{axis}[relw={-0.3}{1.3}, y filter/.code={\pgfmathparse{max(#1,0)}\pgfmathresult}]
    %\addplot table[x=time, y=value.DAX] {plot-data/ms_relw.txt}\closedcycle;
    %\addlegendentry{DAX}
    %\addplot table[x=time, y=value.Dow.Jones] {plot-data/ms_relw.txt}\closedcycle;
    %\addlegendentry{Dow Jones}
    %\addplot table[x=time, y=value.Nikkei] {plot-data/ms_relw.txt}\closedcycle;
    %\addlegendentry{Nikkei}
    %\addplot table[x=time, y=value.mixed] {plot-data/ms_relw.txt}\closedcycle;
    %\addlegendentry{Euribor}
  %\end{axis}
  %\begin{axis}[relw={0}{1}, y filter/.code={\pgfmathparse{min(#1,0)}\pgfmathresult}]
    %\addplot table[x=time, y=value.DAX] {plot-data/ms_relw.txt}\closedcycle;
    %\addplot table[x=time, y=value.Dow.Jones] {plot-data/ms_relw.txt}\closedcycle;
    %\addplot table[x=time, y=value.Nikkei] {plot-data/ms_relw.txt}\closedcycle;
  %\end{axis}
%\end{tikzpicture}

\section*{Equal Weight}
\begin{tikzpicture}
  \begin{axis}[w={0}{170}, y filter/.code={\pgfmathparse{max(#1,0)}\pgfmathresult}]
    \addplot table[x=time, y=value.DAX] {plot-data/fw.txt}\closedcycle;
    \addlegendentry{DAX}
    \addplot table[x=time, y=value.Dow.Jones] {plot-data/fw.txt}\closedcycle;
    \addlegendentry{Dow Jones}
    \addplot table[x=time, y=value.Nikkei] {plot-data/fw.txt}\closedcycle;
    \addlegendentry{Nikkei}
  \end{axis}
  \begin{axis}[w={0}{170}, bottom, y filter/.code={\pgfmathparse{min(#1,0)}\pgfmathresult}]
    \addplot table[x=time, y=value.DAX] {plot-data/fw.txt}\closedcycle;
    \addplot table[x=time, y=value.Dow.Jones] {plot-data/fw.txt}\closedcycle;
    \addplot table[x=time, y=value.Nikkei] {plot-data/fw.txt}\closedcycle;
  \end{axis}
\end{tikzpicture}

\section*{Equal Weight Leveraged}
\begin{tikzpicture}
  \begin{axis}[w={0}{170}, y filter/.code={\pgfmathparse{max(#1,0)}\pgfmathresult}]
    \addplot table[x=time, y=value.DAX] {plot-data/fw_lev.txt}\closedcycle;
    \addlegendentry{DAX}
    \addplot table[x=time, y=value.Dow.Jones] {plot-data/fw_lev.txt}\closedcycle;
    \addlegendentry{Dow Jones}
    \addplot table[x=time, y=value.Nikkei] {plot-data/fw_lev.txt}\closedcycle;
    \addlegendentry{Nikkei}
  \end{axis}
  \begin{axis}[w={0}{170}, bottom, y filter/.code={\pgfmathparse{min(#1,0)}\pgfmathresult}]
    \addplot table[x=time, y=value.VXX.Adjusted] {plot-data/fw_lev.txt}\closedcycle;
    \addlegendentry{VXX}
  \end{axis}
\end{tikzpicture}

%\begin{tikzpicture}
%\begin{axis}[
  %colorbrewer cycle list=Set1,
		%no marks,
		%date coordinates in=x,
		%xticklabel=\year,
    %xtick={2008-01-01,2009-01-01,2010-01-01,2011-01-01,2012-01-01, 2013-01-01, 2014-01-01, 2015-01-01},
    %yticklabel style={/pgf/number format/fixed,/pgf/number format/precision=2},
    %ylabel=Asset value,
		%xlabel=Time,
    %legend pos = north west,
    %every axis plot/.append style={thick, smooth},
    %width=\textwidth,
    %height=0.5\textwidth,
    %legend pos = north west,
    %stack plots=y,area style,
    %yticklabel=\pgfmathparse{100*\tick}\pgfmathprintnumber{\pgfmathresult}\,\%,
    %y filter/.code={\pgfmathparse{max(#1,0)}\pgfmathresult},
    %ylabel=Weights,
    %ymin=-0.3,ymax=1.3,
    %trim axis left,trim axis right]
  %\addplot table[x=time, y=value.DAX] {plot-data/minv_relw.txt}\closedcycle;
  %\addlegendentry{DAX}
  %\addplot table[x=time, y=value.Dow.Jones] {plot-data/minv_relw.txt}\closedcycle;
  %\addlegendentry{Dow Jones}
  %\addplot table[x=time, y=value.Nikkei] {plot-data/minv_relw.txt}\closedcycle;
  %\addlegendentry{Nikkei}
%\end{axis}
%\begin{axis}[
  %colorbrewer cycle list=Set1,
    %no marks,
    %axis y line = none,
    %date coordinates in=x,
    %xticklabel=\year,
    %xtick={2008-01-01,2009-01-01,2010-01-01,2011-01-01,2012-01-01, 2013-01-01, 2014-01-01, 2015-01-01},
    %xlabel=Time,
    %every axis plot/.append style={thick, smooth},
    %width=\textwidth,
    %height=0.5\textwidth,
    %legend pos = north west,
    %stack plots=y,area style,
    %stack dir=plus,
    %ymin=-0.3, ymax=1.3,
    %y filter/.code={\pgfmathparse{min(#1,0)}\pgfmathresult},
    %trim axis left,trim axis right]
  %\addplot table[x=time, y=value.DAX] {plot-data/minv_relw.txt}\closedcycle;
  %\addplot table[x=time, y=value.Dow.Jones] {plot-data/minv_relw.txt}\closedcycle;
  %\addplot table[x=time, y=value.Nikkei] {plot-data/minv_relw.txt}\closedcycle;
%\end{axis}
%\end{tikzpicture}

%\chapter*{Asset Universe}
%We're looking at 4 assets: DAX

%\begin{performanceplot}[ylabel=Asset value]
  %\addplot table[x=time, y=value.DAX] {plot-data/assets.txt};
  %\addlegendentry{DAX}
  %\addplot table[x=time, y=value.Dow.Jones] {plot-data/assets.txt};
  %\addlegendentry{Dow Jones}
  %\addplot table[x=time, y=value.Nikkei] {plot-data/assets.txt};
  %\addlegendentry{Nikkei}
  %\addplot table[x=time, y=value.VIX] {plot-data/assets.txt};
  %\addlegendentry{!VIX}
%\end{performanceplot}


%\chapter*{Investment Opportunities}
%\section*{Max Sharpe Ratio}
%\portfolioperformanceplot{max_sharpe}{}

%\section*{Equal-Weighted}

%\section*{Portfolio 3}

%\chapter*{Performance Evaluation}

%\section*{Min Variance}
%\doubleplot{minv}

%\section*{Maximum Sharpe Ratio}
%\doubleplot{ms}


%\section*{1/N}
%\begin{figure}[!h]
%\centering
%\begin{subfigure}[b]{\textwidth}
%\centering
%\decomposeplot{equal}{trim axis left,trim axis right}
%\end{subfigure}
%\begin{subfigure}[b]{\textwidth}
%\centering
%\decomposerelplot{equal_relw}{trim axis left,trim axis right}
%\end{subfigure}
%\end{figure}

%\section*{Min Variance}
%\begin{figure}[!h]
%\centering
%\begin{subfigure}[b]{\textwidth}
%\centering
%\decomposeplot{minv}{}
%\end{subfigure}
%\begin{subfigure}[b]{\textwidth}
%\centering
%\decomposerelplot{minv_relw}{}
%\end{subfigure}
%\end{figure}

%\section*{Black-Litterman}
%\begin{figure}[!h]
%\centering
%\begin{subfigure}[b]{\textwidth}
%\centering
%\decomposeplot{black_littie}{}
%\end{subfigure}
%\begin{subfigure}[b]{\textwidth}
%\centering
%\decomposerelplot{black_littie_relw}{}
%\end{subfigure}
%\end{figure}

%\section*{Max Sharpe}
%\begin{figure}[!h]
%\centering
%\begin{subfigure}[b]{\textwidth}
%\centering
%\decomposeplot{ms}{}
%\end{subfigure}
%\begin{subfigure}[b]{\textwidth}
%\centering
%\decomposerelplot{ms_relw}{}
%\end{subfigure}
%\end{figure}

\end{document}
